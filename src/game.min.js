var Bigboss=function(){var e=new createjs.Event("gameEvent",!0);e.id="bigbossKilled",e.points=0;var a=Globals.stage,t=Globals.assetManager,o=Globals.objectPool,n=(Globals.gameConstants,ShapeState.ATTACKING),s=this,i="",r=0,l=[],d=0,p=0,v=0,m="",u=null,c=o.playerPool[0],y=new createjs.Container,g=t.getSprite("assets"),h=t.getSprite("assets");this.sprite=y,this.getState=function(){return n},this.startMe=function(e,t,s,D,S,f){v=0,r=D,n=ShapeState.ATTACKING,i=e,g.gotoAndPlay(i),y.addChild(g),i.indexOf("Mini")!=-1?(h.gotoAndStop("bossMiniExplosion"+r),m="miniBossExplosion"):(h.gotoAndStop("bossExplosion"+r),m="bossExplosion"),y.x=t,y.y=s,y.rotation=0,l=[],p=S.length,d=p;for(var E=0;E<p;E++){var b=S[E],P=o.getTurret(),M="bullet1";void 0!==b.bulletType&&(M=b.bulletType),P.startMe(b.type,b.x,b.y,b.freq,M,this),l.push(P)}u=MoveFunctions[f.type],void 0!==f&&(y.moveData=f,y.moveData.player=c,y.moveData.ready=!1);var x=y.getBounds();y.setBounds(x.x,x.y,x.width,x.height),a.addChild(y)},this.stopMe=function(){l=null,g.stop(),h.stop(),y.removeChild(h),a.removeChild(y),o.dispose(this)},this.turretKilled=function(){d--,d<=0&&this.killMe()},this.killMe=function(){n=ShapeState.KILLED,h.x=g.x,h.y=g.y,h.rotation=360-y.rotation,g.gotoAndPlay(i+"Kill"),g.addEventListener("animationend",function(e){e.remove(),g.stop()}),createjs.Sound.play(m),y.addChild(h),h.play(),h.addEventListener("animationend",function(t){t.remove(),e.target=null,e.points=r,a.dispatchEvent(e),s.stopMe()})},this.updateMe=function(){if(n!==ShapeState.KILLED){n!==ShapeState.KILLED&&c.getState()!==PlayerState.KILLED&&c.getState()!==PlayerState.HIT&&ndgmr.checkPixelCollision(g,c.sprite)&&c.killMe();var e=u(y);e||this.stopMe(),v++}}},Bullet=function(){var e,a,t=(BulletState.KILLED,BulletState.MOVING,Globals.stage),o=Globals.assetManager,n=Globals.objectPool,s=Globals.checkRadiusCollision,i=null,r="",l=0,d=0,p=!1,v=0,m=0,u=0,c=Globals.stage.canvas,y=-10,g=c.width+10,h=-10,D=c.height+10,S=this,f=n.shapePool,E=(n.bigbossPool,n.turretPool),b=n.playerPool[0],P=o.getSprite("assets","bullet");this.startMe=function(o,n,s,c,y,g,h,D,f,E){r=o,i=n,p=g,v=c,m=0,u=E,l=BulletState.MOVING,d=y,e=Globals.cosTable[f]*v,a=Globals.sinTable[f]*v,P.gotoAndStop(s),"laser"===r?(P.play(),P.addEventListener("animationend",function(e){e.remove(),S.stopMe()})):"bounce"!==r&&"superBounce"!==r||P.play(),P.x=h,P.y=D,P.rotation=f;var b=t.getChildIndex(i.sprite);t.addChildAt(P,b)},this.stopMe=function(){P.stop(),P.y=-2e3,t.removeChild(P),n.dispose(S)},this.killMe=function(t){l=BulletState.KILLED,e=0,a=0,i=null,t?(P.gotoAndPlay("bulletExplosion"),P.addEventListener("animationend",function(e){e.remove(),S.stopMe()})):this.stopMe()},this.updateMe=function(){if(l===BulletState.MOVING){if("laser"===r?P.x=i.sprite.x:(P.x+=e,P.y+=a),"bounce"===r||"superBounce"===r)P.y>D||P.y<h?(a*=-1,m++):(P.x<y||P.x>g)&&(e*=-1,m++),P.x+=e,P.y+=a,m>=3&&this.stopMe();else if(P.y>D||P.x<y||P.x>g||P.y<h)return void this.killMe();if("Player"===i.name){for(var t=!1,o=f.length,n=0;n<o;n++){var v=f[n];"laser"===r?v.used&&v.getState()!==ShapeState.KILLED&&ndgmr.checkRectCollision(P,v.sprite)&&(t=v.killMe(d,!0),p||this.killMe(!t)):v.used&&v.getState()!==ShapeState.KILLED&&s(P,v.sprite,u+v.radius)&&(t=v.killMe(d,!0),p||this.killMe(!t))}for(o=E.length,n=0;n<o;n++){var c=E[n];"laser"===r?c.used&&c.getState()!==ShapeState.KILLED&&ndgmr.checkRectCollision(P,c.sprite)&&(t=c.killMe(d),p||this.killMe(!t)):c.used&&c.getState()!==ShapeState.KILLED&&s(P,c.sprite,u+c.radius,c.sprite.x*-1,c.sprite.y*-1)&&(t=c.killMe(d),p||this.killMe(!t))}}else"Shape"!==i.name&&"Bigboss"!==i.name||b.getState()!==PlayerState.KILLED&&b.getState()!==PlayerState.HIT&&s(P,b.sprite,u+22)&&(b.hitMe(d),this.killMe(!0))}}},BulletState={KILLED:-1,MOVING:1};(function(){"use strict";function e(){u=!1,c=!1,y=!1,g=!1,h=!1,S.setScreen("gameScreen"),P.startMe(),M=b.getPlayer(),M.startMe(),Globals.gameState=GameStates.PLAYING,console.log(">> game started")}function a(){for(var e=D.length,a=null,t=0;t<e;t++)a=D[t],null!==a&&a.stopMe()}function t(){console.log(">> initializing"),Globals.gameState=GameStates.INITIALIZE,m=document.getElementById("stage"),m.width=800,m.height=800,v=new createjs.Stage(m),Globals.stage=v,f=new AssetManager(v),Globals.assetManager=f,f.loadAssets(gameManifest),v.addEventListener("onAssetLoaded",o),v.addEventListener("onAllAssetsLoaded",n),E=new GamepadManager,E.setup(gamepadManifest),Globals.gamepadManager=E,window.addEventListener("blur",l),window.addEventListener("focus",d),createjs.Ticker.useRAF=!0,createjs.Ticker.setFPS(Globals.gameConstants.FRAME_RATE),createjs.Ticker.addEventListener("tick",p)}function o(e){"ui"===e.id&&(S=new ScreenManager,S.startBackground(),Globals.gameState=GameStates.SETUP),null!==S&&S.load.updateProgress()}function n(){console.log(">> setup"),v.removeEventListener("onAssetLoaded",o),v.removeEventListener("onAllAssetsLoaded",n),v.addEventListener("gameEvent",r),b=new ObjectPool(v,f),Globals.objectPool=b,b.init(),D=b.getUpdateList(),P=new WaveFactory,document.addEventListener("keydown",s),document.addEventListener("keyup",i),S.startMe(),S.setScreen("introScreen"),Globals.gameState=GameStates.INTRO,console.log(">> intro gameScreen ready")}function s(e){Globals.gameState===GameStates.PLAYING&&(40===e.keyCode||83===e.keyCode?u=!0:38===e.keyCode||87===e.keyCode?c=!0:37===e.keyCode||65===e.keyCode?y=!0:39===e.keyCode||68===e.keyCode?g=!0:32===e.keyCode&&(h=!0)),e.preventDefault()}function i(t){Globals.gameState===GameStates.INTRO?32===t.keyCode&&e():Globals.gameState===GameStates.PLAYING?40===t.keyCode||83===t.keyCode?u=!1:38===t.keyCode||87===t.keyCode?c=!1:37===t.keyCode||65===t.keyCode?y=!1:39===t.keyCode||68===t.keyCode?g=!1:32===t.keyCode?h=!1:16===t.keyCode&&M.flipMe():Globals.gameState===GameStates.HIGHSCORE?40===t.keyCode?S.highScore.moveSelector("down"):38===t.keyCode?S.highScore.moveSelector("up"):37===t.keyCode?S.highScore.moveSelector("left"):39===t.keyCode?S.highScore.moveSelector("right"):32===t.keyCode&&S.highScore.selectInitial():Globals.gameState===GameStates.GAMEOVER&&32===t.keyCode&&(Globals.gameState=GameStates.HIGHSCORE,S.setScreen("highScoreScreen"),a()),t.preventDefault()}function r(e){switch(e.id){case"pointsChange":S.game.adjustPoints(e.points);break;case"playerChangeDir":S.setDirection(e.dir);break;case"playerPowerChange":S.game.setPower(e.power);break;case"playerLivesChange":S.game.setLives(e.lives);break;case"playerAmmoChange":S.game.setAmmo(e.ammo,e.weaponType);break;case"bigbossKilled":S.game.adjustPoints(e.points);break;case"levelChange":S.game.setLevelName(e.level,e.levelTitle);break;case"gameOver":S.setScreen("gameOverScreen");break;case"highScoreComplete":Globals.gameState=GameStates.INTRO,S.setScreen("introScreen");break;case"newHighScore":S.game.setHighScore(e.score);break;case"godLikeMode":M.enableGodLike()}}function l(e){createjs.Ticker.setPaused(!0),createjs.Ticker.removeEventListener("tick",p)}function d(e){createjs.Ticker.setPaused(!1),createjs.Ticker.addEventListener("tick",p)}function p(){if(Globals.gameState===GameStates.PLAYING){y?M.goLeft():g?M.goRight():c?M.goUp():u?M.goDown():M.goIdle(),h?M.fire():M.cease();for(var e=D.length,a=null,t=0;t<e;t++)a=D[t],null!==a&&a.updateMe();P.updateMe()}Globals.gameState!==GameStates.INITIALIZE&&S.updateMe(),E.monitorMe(Globals.gameState),v.update()}var v=null,m=null,u=!1,c=!1,y=!1,g=!1,h=!1,D=null,S=null,f=null,E=null,b=null,P=null,M=null;window.addEventListener("load",t)})();var GameStates={INITIALIZE:-2,SETUP:-1,INTRO:0,PLAYING:1,HIGHSCORE:2,GAMEOVER:3},Globals={stage:null,assetManager:null,objectPool:null,gamepadManager:null,sinTable:[],cosTable:[],gameState:0,gameConstants:{FRAME_RATE:30,HIGHSCORE_SCRIPT1:"handlers/a.php",HIGHSCORE_SCRIPT2:"handlers/d.php",HIGHSCORE_SCRIPT3:"handlers/c.php",PLAYER_SPEED:14,PLAYER_MIN_X:20,PLAYER_MAX_X:780,PLAYER_MIN_Y:40,PLAYER_MAX_Y:750,PLAYER_START_POWER:4,PLAYER_MAX_POWER:4,PLAYER_START_LIVES:3,PERFECT_SCORE_POINTS:2e3,POWERUP_DURATION:8,TURRET_BONUS_ACCURACY:20,SHAPES:{circle:{hp:1,points:50,radius:18,accuracy:30},square:{hp:1,points:50,radius:16,accuracy:80},triangle:{hp:2,points:100,radius:16,accuracy:40},ellipse:{hp:2,points:100,radius:22,accuracy:60},star:{hp:3,points:200,radius:17,accuracy:50},nonagon:{hp:3,points:300,radius:19,accuracy:70},rectangle:{hp:4,points:400,radius:25,accuracy:80},hexagon:{hp:4,points:400,radius:22,accuracy:70},rhombus:{hp:5,points:500,radius:15,accuracy:100},pentagon:{hp:5,points:500,radius:18,accuracy:100}},POWERUPS:{powerupDouble:{category:"weapon",data:"double"},powerupSuperDouble:{category:"weapon",data:"superDouble"},powerupSpread:{category:"weapon",data:"spread"},powerupSuperSpread:{category:"weapon",data:"superSpread"},powerupHeavy:{category:"weapon",data:"heavy"},powerupRapid:{category:"weapon",data:"rapid"},powerupLaser:{category:"weapon",data:"laser"},powerupBounce:{category:"weapon",data:"bounce"},powerupSuperBounce:{category:"weapon",data:"superBounce"},powerupShield:{category:"shield",data:10},powerupPower:{category:"power",data:1},powerupHalfPower:{category:"power",data:3},powerupFullPower:{category:"power",data:6},powerupLife:{category:"life",data:1}},PLAYER_WEAPONS:{single:{freq:8,gunPoints:[[{x:0,y:-20,r:270}],[{x:0,y:20,r:90}]],alternateFire:!1,auto:!1,speed:10,damage:.75,invincible:!1,ammo:-1,radius:6,frame:"bullet"},double:{freq:6,gunPoints:[[{x:-10,y:-5,r:270},{x:10,y:-5,r:270}],[{x:-10,y:5,r:90},{x:10,y:5,r:90}]],alternateFire:!0,auto:!0,speed:20,damage:1,ammo:200,invincible:!1,radius:6,frame:"bullet"},superDouble:{freq:6,gunPoints:[[{x:-10,y:-5,r:270},{x:10,y:-5,r:270}],[{x:-10,y:5,r:90},{x:10,y:5,r:90}]],alternateFire:!1,auto:!0,speed:22,damage:.5,ammo:200,invincible:!1,radius:6,frame:"bullet"},spread:{freq:4,gunPoints:[[{x:0,y:-20,r:270},{x:-20,y:-5,r:250},{x:20,y:-5,r:290}],[{x:0,y:20,r:90},{x:-20,y:5,r:110},{x:20,y:5,r:70}]],alternateFire:!1,auto:!1,speed:20,damage:.5,ammo:300,invincible:!1,radius:4,frame:"spreadBullet"},superSpread:{freq:8,gunPoints:[[{x:0,y:-20,r:270},{x:-20,y:-5,r:225},{x:20,y:-5,r:315},{x:24,y:5,r:0},{x:-24,y:5,r:180},{x:24,y:15,r:45},{x:-24,y:15,r:135}],[{x:0,y:20,r:90},{x:-20,y:5,r:135},{x:20,y:5,r:45},{x:24,y:-5,r:0},{x:-24,y:-5,r:180},{x:24,y:-15,r:315},{x:-24,y:-15,r:225}]],alternateFire:!1,auto:!0,speed:22,damage:1,ammo:500,invincible:!1,radius:4,frame:"spreadBullet"},heavy:{freq:8,gunPoints:[[{x:0,y:-30,r:270}],[{x:0,y:30,r:90}]],alternateFire:!1,auto:!1,speed:10,damage:5,ammo:25,invincible:!0,radius:10,frame:"bullet2"},rapid:{freq:1,gunPoints:[[{x:0,y:-20,r:270}],[{x:0,y:20,r:90}]],alternateFire:!1,auto:!0,speed:12,damage:.4,ammo:600,invincible:!1,radius:2,frame:"rapidBullet"},laser:{freq:0,gunPoints:[[{x:0,y:-28,r:270}],[{x:0,y:28,r:90}]],alternateFire:!1,auto:!1,speed:0,damage:.2,ammo:100,invincible:!0,radius:-1,frame:"laserBullet"},bounce:{freq:0,gunPoints:[[{x:0,y:-20,r:270},{x:-20,y:-5,r:260},{x:20,y:-5,r:280}],[{x:0,y:20,r:90},{x:-20,y:5,r:100},{x:20,y:5,r:80}]],alternateFire:!1,auto:!1,speed:6,damage:.2,ammo:150,invincible:!0,radius:4,frame:"bounceBullet"},superBounce:{freq:0,gunPoints:[[{x:0,y:-20,r:270},{x:-20,y:-5,r:260},{x:20,y:-5,r:280}],[{x:0,y:20,r:90},{x:-20,y:5,r:100},{x:20,y:5,r:80}]],alternateFire:!1,auto:!1,speed:6,damage:.4,ammo:100,invincible:!0,radius:4,frame:"bounceBullet"}}},commaUpScore:function(e){var a=String(e);return a.replace(/\B(?=(\d{3})+(?!\d))/g,",")},radianMe:function(e){return e*(Math.PI/180)},randomMe:function(e,a){var t=0;return t=Math.round(Math.random()*(a-e))+e},checkRadiusCollision:function(e,a,t,o,n){var s,i;if(void 0!==o){var r=a.localToGlobal(a.x+o,a.y+n);s=e.x-r.x,i=e.y-r.y}else s=e.x-a.x,i=e.y-a.y;var l=Math.sqrt(s*s+i*i);return l<=t},sendMe:function(e,a){var t=new XMLHttpRequest;t.addEventListener("readystatechange",function(e){4===t.readyState&&200===t.status&&a(t)}),t.open("GET",e,!0),t.send()},init:function(){for(var e,a=Math.PI/180,t=0;t<=360;t++)e=t*a,Globals.sinTable[t]=Math.sin(e),Globals.cosTable[t]=Math.cos(e)}};Globals.init();var MoveFunctions={none:function(e){return!0},down:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.y+=e.moveData.speed,!(e.y>Globals.stage.canvas.height+e.moveData.height)},downAndStop:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),void 0===e.moveData.rotate&&(e.moveData.rotate=!1),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.y<e.moveData.stopAt&&(e.y+=e.moveData.speed),!0},rightAndStop:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),void 0===e.moveData.rotate&&(e.moveData.rotate=!1),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.x<e.moveData.stopAt&&(e.x+=e.moveData.speed),!0},leftAndStop:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),void 0===e.moveData.rotate&&(e.moveData.rotate=!1),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.x>e.moveData.stopAt&&(e.x-=e.moveData.speed),!0},upAndStop:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),void 0===e.moveData.rotate&&(e.moveData.rotate=!1),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.y>e.moveData.stopAt&&(e.y-=e.moveData.speed),!0},up:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.y-=e.moveData.speed,!(e.y<=-e.moveData.height)},left:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.x-=e.moveData.speed,!(e.x<=-e.moveData.width)},right:function(e){return e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++,e.x+=e.moveData.speed,!(e.x>=Globals.stage.canvas.width+e.moveData.width)},kamikaze:function(e){e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0),e.moveData.rotate&&e.rotation++;var a=Math.floor(180+57.2957795*Math.atan2(e.y-e.moveData.player.sprite.y,e.x-e.moveData.player.sprite.x)),t=Globals.cosTable[a]*e.moveData.speed,o=Globals.sinTable[a]*e.moveData.speed;return e.x=e.x+t,e.y=e.y+o,!0},diagonal:function(e){if(!e.moveData.ready){void 0===e.moveData.speed&&(e.moveData.speed=2),e.rotation=e.moveData.angle;var a=Globals.radianMe(e.moveData.angle);e.moveData.xDisplace=Math.cos(a)*e.moveData.speed,e.moveData.yDisplace=Math.sin(a)*e.moveData.speed,e.moveData.ready=!0}return e.moveData.rotate&&e.rotation++,e.x=e.x+e.moveData.xDisplace,e.y=e.y+e.moveData.yDisplace,!(e.x<-e.moveData.width||e.x>Globals.stage.canvas.width+e.moveData.width||e.y<-e.moveData.height||e.y>Globals.stage.canvas.height+e.moveData.height)},diagonalAndStop:function(e){if(!e.moveData.ready){void 0===e.moveData.speed&&(e.moveData.speed=2),e.rotation=e.moveData.angle;var a=Globals.radianMe(e.moveData.angle);e.moveData.xDisplace=Math.cos(a)*e.moveData.speed,e.moveData.yDisplace=Math.sin(a)*e.moveData.speed,e.moveData.ready=!0}return e.moveData.rotate&&e.rotation++,(e.x>e.moveData.stopAt+10||e.x<e.moveData.stopAt-10)&&(e.x=e.x+e.moveData.xDisplace,e.y=e.y+e.moveData.yDisplace),!(e.x<-e.moveData.width||e.x>Globals.stage.canvas.width+e.moveData.width||e.y<-e.moveData.height||e.y>Globals.stage.canvas.height+e.moveData.height)},zigzag:function(e){if(!e.moveData.ready){void 0===e.moveData.speed&&(e.moveData.speed=2),e.rotation=e.moveData.angle;var a=Globals.radianMe(e.moveData.angle);e.moveData.xDisplace=Math.cos(a)*e.moveData.speed,e.moveData.yDisplace=Math.sin(a)*e.moveData.speed,void 0===e.moveData.bounces&&(e.moveData.bounces=3),e.moveData.bounceCount=0,e.moveData.onStage=!1,e.moveData.ready=!0}return e.moveData.rotate&&e.rotation++,e.x=e.x+e.moveData.xDisplace,e.y=e.y+e.moveData.yDisplace,e.moveData.onStage||e.x>0&&e.y>0&&e.x<Globals.stage.canvas.width&&e.y<Globals.stage.canvas.height&&(e.moveData.onStage=!0),e.moveData.onStage&&e.moveData.bounceCount<e.moveData.bounces&&(e.y>Globals.stage.canvas.height||e.y<0?(e.moveData.yDisplace=e.moveData.yDisplace*-1,e.moveData.bounceCount++):(e.x<0||e.x>Globals.stage.canvas.width)&&(e.moveData.xDisplace=e.moveData.xDisplace*-1,e.moveData.bounceCount++)),!(e.x<-e.moveData.width||e.x>Globals.stage.canvas.width+e.moveData.width||e.y<-e.moveData.height||e.y>Globals.stage.canvas.height+e.moveData.height)},switch:function(e){if(e.moveData.ready||(void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.stage=0,e.moveData.ready=!0),"down"===e.moveData.dir){if(e.moveData.rotate&&e.rotation++,0===e.moveData.stage)e.y+=e.moveData.speed,e.y>=e.moveData.switchAt&&(e.moveData.stage=1);else if(e.y-=e.moveData.speed,e.y<=-e.moveData.height)return!1;return!0}if(e.moveData.rotate&&e.rotation++,0===e.moveData.stage)e.y-=e.moveData.speed,e.y<=e.moveData.switchAt&&(e.moveData.stage=1);else if(e.y+=e.moveData.speed,e.y>=Globals.stage.canvas.height+e.moveData.height)return!1;return!0},looping:function(e){e.moveData.ready||(e.moveData.stage=0,void 0===e.moveData.speed&&(e.moveData.speed=2),e.moveData.ready=!0);var a=0;if("left"===e.moveData.dir){if(0===e.moveData.stage)e.x-=e.moveData.speed,e.x<=e.moveData.cx+e.moveData.r&&(e.moveData.stage=1);else if(1===e.moveData.stage)e.rotation+=e.moveData.speed,a=Globals.radianMe(e.rotation),e.x=e.moveData.cx+e.moveData.r*Math.cos(a),e.y=e.moveData.cy+e.moveData.r*Math.sin(a),e.rotation>=360*e.moveData.loops&&(e.moveData.stage=2);else if(2===e.moveData.stage){if(void 0!==e.moveData.stop&&e.moveData.stop)return!0;if(e.x-=e.moveData.speed,e.x<-e.moveData.width)return!1}return!0}if("right"===e.moveData.dir){if(0===e.moveData.stage)e.x+=e.moveData.speed,e.x>=e.moveData.cx-e.moveData.r&&(e.moveData.stage=1);else if(1===e.moveData.stage)e.rotation+=e.moveData.speed,a=Globals.radianMe(e.rotation+180),e.x=e.moveData.cx+e.moveData.r*Math.cos(a),e.y=e.moveData.cy+e.moveData.r*Math.sin(a),e.rotation>=360*e.moveData.loops&&(e.moveData.stage=2);else if(2===e.moveData.stage){if(void 0!==e.moveData.stop&&e.moveData.stop)return!0;if(e.x+=e.moveData.speed,e.x>Globals.stage.canvas.width+e.moveData.width)return!1}return!0}if("down"===e.moveData.dir){if(0===e.moveData.stage)e.y+=e.moveData.speed,e.y>=e.moveData.cy-e.moveData.r&&(e.moveData.stage=1);else if(1===e.moveData.stage)e.rotation+=e.moveData.speed,a=Globals.radianMe(e.rotation+270),e.x=e.moveData.cx+e.moveData.r*Math.cos(a),e.y=e.moveData.cy+e.moveData.r*Math.sin(a),e.rotation>=360*e.moveData.loops&&(e.moveData.stage=2);else if(2===e.moveData.stage){if(void 0!==e.moveData.stop&&e.moveData.stop)return!0;if(e.y+=e.moveData.speed,e.y>Globals.stage.canvas.height+e.moveData.height)return!1}return!0}if("up"===e.moveData.dir){if(0===e.moveData.stage)e.y-=e.moveData.speed,e.y<=e.moveData.cy+e.moveData.r&&(e.moveData.stage=1);else if(1===e.moveData.stage)e.rotation+=e.moveData.speed,a=Globals.radianMe(e.rotation+90),e.x=e.moveData.cx+e.moveData.r*Math.cos(a),e.y=e.moveData.cy+e.moveData.r*Math.sin(a),e.rotation>=360*e.moveData.loops&&(e.moveData.stage=2);else if(2===e.moveData.stage){if(void 0!==e.moveData.stop&&e.moveData.stop)return!0;if(e.y-=e.moveData.speed,e.y<-e.moveData.height)return!1}return!0}}},Player=function(){var e=new createjs.Event("gameEvent",!0);e.id="playerChangeDir",e.dir=1;var a=new createjs.Event("gameEvent",!0);a.id="playerLivesChange",a.lives=0;var t=new createjs.Event("gameEvent",!0);t.id="playerPowerChange",t.power=0;var o=new createjs.Event("gameEvent",!0);o.id="playerAmmoChange",o.ammo=u;var n=new createjs.Event("gameEvent",!0);n.id="gameOver";var s=Globals.stage,i=Globals.assetManager,r=Globals.objectPool,l=Globals.gameConstants,d=l.PLAYER_START_POWER,p=l.PLAYER_START_LIVES,v=0,m=0,u=0,c=0,y=0,g=l.PLAYER_SPEED,h=0,D=l.PLAYER_SPEED,S=l.PLAYER_MIN_X,f=l.PLAYER_MAX_X,E=l.PLAYER_MIN_Y,b=l.PLAYER_MAX_Y,P=0,M="",x=null,L=!1,A=0,G=0,w=0,T=0,I=!1,C=i.getSprite("assets","playerEntrance");C.stop();var R=i.getSprite("assets","playerShield");R.stop(),this.sprite=C;var k=s.canvas.height-C.getBounds().height-50,j=s.canvas.width/2,N=s.canvas.height+C.getBounds().height,_=this;this.setWeapon=function(e){M=e,x=l.PLAYER_WEAPONS[e],u=x.ammo,m=0,o.target=null,o.ammo=u,o.weaponType=M,s.dispatchEvent(o)},this.getState=function(){return v},this.getPower=function(){return d},this.getShieldEnabled=function(){return L},this.setPower=function(e){d=e,d>l.PLAYER_START_POWER&&(d=l.PLAYER_START_POWER),t.target=null,t.power=d,s.dispatchEvent(t)},this.getLives=function(){return p},this.setLives=function(e){p=e,a.target=null,a.lives=p,s.dispatchEvent(a)},this.startMe=function(){I=!1,p=Globals.gameConstants.PLAYER_START_LIVES,this.setWeapon("single"),this.spawnMe()},this.stopMe=function(){createjs.Tween.removeTweens(R),createjs.Tween.removeTweens(C),s.removeChild(R),s.removeChild(C),C.stop(),r.dispose(this)},this.spawnMe=function(){v=PlayerState.ENTERING,y=0,h=0,P=0,m=0,A=0,G=0,w=100,L=!0,c=0,e.target=null,e.dir=c,s.dispatchEvent(e),T=0,C.rotation=T,R.rotation=T,this.setPower(Globals.gameConstants.PLAYER_START_POWER),createjs.Tween.removeTweens(R),createjs.Tween.removeTweens(C),s.removeChild(R),C.gotoAndStop("playerEntrance"),C.x=j,C.y=N,C.rotation=T,R.rotation=T,createjs.Tween.get(C,{useTicks:!0}).to({y:k},30,createjs.Ease.cubicOut).call(function(){C.addEventListener("animationend",function(e){e.remove(),C.stop(),v=PlayerState.IDLE,C.gotoAndPlay("playerIdle"),_.shieldMe(1.5,1)}),C.play(),createjs.Sound.play("flipIn")}),s.addChild(C),createjs.Sound.play("playerEnter")},this.goLeft=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&("playerLeft"!=C.currentAnimation&&(C.gotoAndPlay("playerLeft"),createjs.Sound.play("playerMove")),L&&R.gotoAndStop("playerShieldLeft"),v=PlayerState.MOVING_LEFT)},this.goRight=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&("playerRight"!=C.currentAnimation&&(C.gotoAndPlay("playerRight"),createjs.Sound.play("playerMove")),L&&R.gotoAndStop("playerShieldRight"),v=PlayerState.MOVING_RIGHT)},this.goUp=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&("playerIdle"!=C.currentAnimation&&C.gotoAndPlay("playerIdle"),L&&R.gotoAndStop("playerShield"),v=PlayerState.MOVING_UP)},this.goDown=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&("playerIdle"!=C.currentAnimation&&C.gotoAndPlay("playerIdle"),L&&R.gotoAndStop("playerShield"),v=PlayerState.MOVING_DOWN)},this.goIdle=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&("playerIdle"!=C.currentAnimation&&C.gotoAndPlay("playerIdle"),L&&R.gotoAndStop("playerShield"),v=PlayerState.IDLE)},this.flipMe=function(){v!==PlayerState.ENTERING&&v!==PlayerState.KILLED&&(0===c?(createjs.Tween.get(C,{useTicks:!0}).to({rotation:180},6),createjs.Tween.get(R,{useTicks:!0}).to({rotation:180},6),T=180,c=1,createjs.Sound.play("flipIn")):(createjs.Tween.get(C,{useTicks:!0}).to({rotation:0},6),createjs.Tween.get(R,{useTicks:!0}).to({rotation:0},6),T=0,c=0,createjs.Sound.play("flipOut")),e.target=null,e.dir=c,s.dispatchEvent(e))},this.fire=function(){if(v!==PlayerState.ENTERING&&v!==PlayerState.KILLED){if(P===x.freq){for(var e=x.gunPoints[c],a=0;a<e.length;a++)if(x.alternateFire&&m===a||!x.alternateFire){var t=r.getBullet();if(t.startMe(M,this,x.frame,x.speed,x.damage,x.invincible,C.x+e[a].x,C.y+e[a].y,e[a].r,x.radius),createjs.Sound.play(M),u!=-1&&(u--,o.target=null,o.ammo=u,o.weaponType=M,s.dispatchEvent(o),u<=0)){I?this.setWeapon("double"):this.setWeapon("single");break}}m++,m===e.length&&(m=0),P=0,x.auto||(P=x.freq+1)}x.auto&&P++}},this.cease=function(){P=x.freq},this.hitMe=function(e){return L?void createjs.Sound.play("hitWithShield"):(this.setPower(d-e),createjs.Sound.play("playerHit"),void(d<=0?this.killMe():(C.rotation=T,createjs.Tween.get(C,{useTicks:!0}).to({rotation:C.rotation+10},3).to({rotation:C.rotation-10},3).to({rotation:C.rotation},3))))},this.shieldMe=function(e,a){L=!0,A=0,void 0===a&&(a=1),G=(e-a)*l.FRAME_RATE,w=e*l.FRAME_RATE,R.x=C.x,R.y=C.y,s.addChild(R)},this.killMe=function(){L&&d>0||(v=PlayerState.KILLED,createjs.Tween.removeTweens(R),s.removeChild(R),C.gotoAndPlay("playerKilled"),createjs.Sound.play("explosion4"),C.addEventListener("animationend",function(e){e.remove(),_.setPower(0),_.setLives(p-1),p<=0?(C.stop(),C.y=-2e3,n.target=null,s.dispatchEvent(n),_.stopMe()):_.spawnMe()}))},this.enableGodLike=function(){I=!0,"single"===M&&this.setWeapon("double")},this.updateMe=function(){v!==PlayerState.KILLED&&v!==PlayerState.ENTERING&&(v===PlayerState.MOVING_LEFT?(h=0,y>-g&&(y-=2)):v===PlayerState.MOVING_RIGHT?(h=0,y<g&&(y+=2)):v===PlayerState.MOVING_UP?(y=0,h>-D&&(h-=2)):v===PlayerState.MOVING_DOWN?(y=0,h<D&&(h+=2)):v===PlayerState.IDLE&&(0===y&&0===h||(y<0?(y+=2,y>0&&(y=0)):y>0?(y-=2,y<0&&(y=0)):h<0?(h+=2,h>0&&(h=0)):h>0&&(h-=2,h<0&&(h=0)),0===y&&0===h&&C.gotoAndPlay("playerIdle"))),C.x+=y,C.y+=h,C.y<E?(C.y=E,h=0):C.y>b?(C.y=b,h=0):C.x<S?(C.x=S,y=0):C.x>f&&(C.x=f,y=0),L&&(A<w?(R.x=C.x,R.y=C.y,A++,A>=G&&createjs.Tween.get(R,{useTicks:!0,loop:!0}).to({alpha:0},8).to({alpha:1},8)):(createjs.Tween.removeTweens(R),s.removeChild(R),L=!1)))}},PlayerState={ENTERING:-1,IDLE:0,MOVING_LEFT:2,MOVING_RIGHT:3,MOVING_UP:4,MOVING_DOWN:5,KILLED:6},Powerup=function(){var e=Globals.stage,a=Globals.assetManager,t=Globals.objectPool,o=Globals.gameConstants,n=Globals.checkRadiusCollision,s=this,i=ShapeState.IDLE,r="",l=0,d=o.FRAME_RATE,p=0,v=t.playerPool[0],m=a.getSprite("assets");this.sprite=m,this.startMe=function(a,t,o){r=a,i=ShapeState.IDLE,m.gotoAndStop(r),l=0,p=0,m.x=t,m.y=o,m.scaleX=.1,m.scaleY=.1,createjs.Tween.get(m,{useTicks:!0}).to({scaleX:1,scaleY:1},10).call(function(){createjs.Sound.play("powerupAppear"),createjs.Tween.get(m,{useTicks:!0,loop:!0}).to({x:t-5},8).to({x:t},8)}),e.addChild(m)},this.stopMe=function(){createjs.Tween.removeTweens(m),m.stop(),e.removeChild(m),t.dispose(this)},this.killMe=function(){i=ShapeState.KILLED,createjs.Tween.removeTweens(m),m.gotoAndPlay("powerupKill"),m.addEventListener("animationend",function(e){s.stopMe()})},this.updateMe=function(){if(i!==ShapeState.KILLED){if(l%d===0&&(p++,p>=o.POWERUP_DURATION))return createjs.Sound.play("powerupRemove"),void this.killMe();if(v.getState()===PlayerState.KILLED)return void this.killMe();if(n(m,v.sprite,39)){var e=o.POWERUPS[r];if("weapon"===e.category){var a=e.data;v.setWeapon(a)}else"power"===e.category?v.setPower(v.getPower()+e.data):"shield"===e.category?v.shieldMe(e.data):"life"===e.category&&v.setLives(v.getLives()+e.data);createjs.Sound.play("powerupPickup"),this.killMe()}l++}}},PowerupState={IDLE:0,KILLED:1},Shape=function(){var e=new createjs.Event("gameEvent",!0);e.id="pointsChange",e.points=0;var a=Globals.stage,t=Globals.assetManager,o=Globals.objectPool,n=Globals.gameConstants,s=Globals.randomMe,i="",r=this,l=ShapeState.ATTACKING,d=0,p=0,v=0,m=0,u="",c=!1,y=-1,g="",h=0,D=0,S=o.playerPool[0],f=t.getSprite("assets");this.sprite=f,this.radius=0;var E=null;this.getState=function(){return l},this.startMe=function(t,o,s,r,b,P){if(h=0,i=t,d=n.SHAPES[i].points,D=n.SHAPES[i].accuracy,this.radius=n.SHAPES[i].radius,e.points=d,l=ShapeState.ATTACKING,v=n.SHAPES[i].hp,p=v,m=v/2,u=r,createjs.Tween.removeTweens(f),c=!1,null!==b&&(c=!0,y=b.freq,g=void 0!==b.bulletType?b.bulletType:"bullet1"),f.gotoAndStop(i),f.x=o,f.y=s,f.rotation=0,f.alpha=1,E=MoveFunctions[P.type],void 0!==P){f.moveData=P,f.moveData.player=S,f.moveData.ready=!1;var M=f.getBounds();f.moveData.width=M.width,f.moveData.height=M.height}a.addChild(f)},this.stopMe=function(){f.stop(),createjs.Tween.removeTweens(f),a.removeChild(f),o.dispose(this)},this.killMe=function(t,n){return p-=t,p<=m&&f.currentAnimation.indexOf("Damage")===-1&&(i+="Damage",f.gotoAndStop(i)),p<=0?(l=ShapeState.KILLED,void 0===n||n===!0?(f.rotation=0,f.gotoAndPlay("explosion"+d),createjs.Sound.play("explosion1"),e.target=null,a.dispatchEvent(e)):(f.gotoAndPlay("explosionNoPoints"),createjs.Sound.play("explosion1")),f.addEventListener("animationend",function(e){if(e.remove(),""!==u){var a=o.getPowerup();a.startMe(u,f.x,f.y)}r.stopMe()}),!0):(f.currentAnimation!=i+"Hit"&&f.gotoAndPlay(i+"Hit"),f.addEventListener("animationend",function(e){e.remove(),f.gotoAndStop(i)}),createjs.Sound.play("enemyHit"),!1)},this.fireMe=function(){f.gotoAndPlay(i+"Fire"),f.addEventListener("animationend",function(e){e.remove(),f.gotoAndStop(i)});var e=s(0,99),a=S.sprite.x,t=S.sprite.y;e>=D&&(a+=1==s(1,2)?s(-60,-20):s(20,60));var n=Math.floor(180+57.2957795*Math.atan2(f.y-t,f.x-a)),r=o.getBullet(),l=6,d=1,p=5;"bullet2"===g?(l=8,d=2,p=10):"bullet3"===g&&(l=10,d=3,p=15),r.startMe(g,this,g,l,d,!1,f.x,f.y,n,p),createjs.Sound.play("enemyShoot")},this.updateMe=function(){if(l!==ShapeState.KILLED){l!==ShapeState.KILLED&&S.getState()!==PlayerState.KILLED&&ndgmr.checkPixelCollision(f,S.sprite)&&(S.hitMe(v),u="",S.getShieldEnabled()||this.killMe(p,!1)),c&&h>=y&&S.getState()!=PlayerState.KILLED&&(this.fireMe(),h=0);var t=E(f);t||(l=ShapeState.KILLED,f.alpha=1,f.rotation=0,f.gotoAndStop("lose"+d),f.y>Globals.stage.canvas.height?f.y=Globals.stage.canvas.width-f.getBounds().height/2-5:f.y<0?f.y=f.getBounds().height/2+5:f.x<0?f.x=f.getBounds().width/2+5:f.x>Globals.stage.canvas.width&&(f.x=Globals.stage.canvas.width-f.getBounds().width/2-5),e.target=null,e.points=-d,a.dispatchEvent(e),createjs.Tween.get(f,{useTicks:!0}).to({alpha:0},15).call(function(){r.stopMe()}),createjs.Sound.play("losePoints")),h++}}},ShapeState={ATTACKING:0,KILLED:1},Turret=function(){var e=new createjs.Event("gameEvent",!0);e.id="turretKilled",e.points=0;var a=(Globals.stage,Globals.assetManager),t=Globals.objectPool,o=Globals.gameConstants,n=Globals.randomMe,s=ShapeState.ATTACKING,i=this,r="",l=0,d=0,p=null,v=0,m="",u=0,c=0,y=10,g=0,h=t.playerPool[0],D=a.getSprite("assets");this.sprite=D,this.radius=0,this.getState=function(){return s},this.startMe=function(e,a,t,n,i,y){u=0,r=e,s=ShapeState.ATTACKING,p=y,v=n,l=o.SHAPES[r].hp,this.radius=o.SHAPES[r].radius,g=0,c=o.SHAPES[r].accuracy+o.TURRET_BONUS_ACCURACY,d=l/2,m=i,D.gotoAndStop(r),D.x=a,D.y=t,D.rotation=0,p.sprite.addChild(D)},this.stopMe=function(){D.stop(),p.sprite.removeChild(D),t.dispose(this)},this.killMe=function(e){return l-=e,l<=d&&D.currentAnimation.indexOf("Damage")===-1&&(r+="Damage",D.gotoAndStop(r)),l<=0?(s=ShapeState.KILLED,D.gotoAndPlay("explosionNoPoints"),createjs.Sound.play("explosion3"),D.addEventListener("animationend",function(e){e.remove(),i.stopMe(),p.turretKilled()}),!0):(D.currentAnimation!=r+"Hit"&&D.gotoAndPlay(r+"Hit"),D.addEventListener("animationend",function(e){e.remove(),D.gotoAndStop(r)}),createjs.Sound.play("enemyHit"),!1)},this.fireMe=function(){if(!(g>y)){D.gotoAndPlay(r+"Fire"),D.addEventListener("animationend",function(e){e.remove(),D.gotoAndStop(r)});var e=p.sprite.localToGlobal(D.x,D.y);if(m.indexOf("bullet")===-1){var a=t.getShape();a.startMe(m,e.x,e.y,"",{index:0,freq:60,bulletType:"bullet1"},{type:"kamikaze",speed:3,rotate:!0}),g++,createjs.Sound.play("enemyReleaseShape")}else{var o=n(0,99),s=h.sprite.x,i=h.sprite.y;o>=c&&(s+=1==n(1,2)?n(-50,-20):n(20,50));var l=Math.floor(180+57.2957795*Math.atan2(e.y-i,e.x-s)),d=t.getBullet(),v=6,u=1,S=5;"bullet2"===m?(v=8,u=2,S=10):"bullet3"===m&&(v=10,u=3,S=15),d.startMe(m,p,m,v,u,!1,e.x,e.y,l,S),createjs.Sound.play("enemyShoot")}}},this.updateMe=function(){s!==ShapeState.KILLED&&(u>=v&&h.getState()!=PlayerState.KILLED&&(this.fireMe(),u=0),u++)}};