var AssetManager=function(e){function t(t){switch(t.item.type){case createjs.LoadQueue.IMAGE:var n=t.item.id,r=t.result,i=l[n];i.images=[r];var a=new createjs.SpriteSheet(i);c[n]=a;break;case createjs.LoadQueue.JSON:var s=t.item.forSpritesheet;l[s]=t.result}o++,d.target=null,d.id=t.item.id,e.dispatchEvent(d)}function n(e){console.log("Preloader > Error Loading asset")}function r(t){o>=s&&(l=null,preloader.removeAllEventListeners(),e.dispatchEvent(h))}function i(t){o>=s&&(l=null,preloader.removeAllEventListeners(),e.dispatchEvent(eventScreensLoaded))}var a=null,o=-1,s=-1,c=[],l=[];preloader=new createjs.LoadQueue;var h=new createjs.Event("onAllAssetsLoaded"),d=new createjs.Event("onAssetLoaded");this.getSprite=function(e,t){var n=new createjs.Sprite(c[e]);return n.name=e,n.x=0,n.y=0,void 0!==t?n.gotoAndPlay(t):n.currentFrame=0,n},this.getProgress=function(){return o/s},this.getSpriteSheet=function(e){return c[e]},this.getProgress=function(){return o/s},this.loadScreens=function(e){a=e,o=0,s=1,preloader.addEventListener("fileload",t),preloader.addEventListener("error",n),preloader.addEventListener("complete",i),preloader.loadFile(a)},this.loadAssets=function(e){a=e,o=0,s=a.length,createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashAudioPlugin]),createjs.Sound.alternateExtensions=["mp3","wav"],preloader.installPlugin(createjs.Sound),preloader.addEventListener("fileload",t),preloader.addEventListener("error",n),preloader.addEventListener("complete",r),preloader.setMaxConnections(1),preloader.loadManifest(a)}},GamepadManager=function(){function e(){return"getGamepads"in navigator}function t(){console.log(">> gamepad connected"),o=navigator.getGamepads()[0];for(var e=0;e<o.buttons.length;e++)s[e]=!1;for(e=0;e<r.joystick.length;e++)c[e]=!1;l=new Event("keydown"),h=new Event("keyup"),i.connected=!0}function n(){i.connected=!1,console.log(">> gamepad disconnected")}this.connected=!1;var r=null,i=this,a=0,o=null,s=[],c=[],l=null,h=null;this.setup=function(i){if(r=i,a=0,e()){window.addEventListener("gamepadconnected",t),window.addEventListener("gamepaddisconnected",n);var o=window.setInterval(function(){navigator.getGamepads()[0]&&(this.active||t(),window.clearInterval(o)),a++,a>=25&&(window.clearInterval(o),console.log(">> abandon gamepad connection"))},500)}},this.monitorMe=function(e){if(this.connected){for(var t=navigator.getGamepads()[0],n=0;n<r.buttons.length;n++){var i=r.buttons[n];i.gameState===e&&(i.clipping&&void 0!==i.clipping?t.buttons[i.id].pressed&&(l.keyCode=i.keyCode,document.dispatchEvent(l)):t.buttons[i.id].pressed&&!s[i.id]?(i.keydown&&(l.keyCode=i.keyCode,document.dispatchEvent(l)),s[i.id]=!0):!t.buttons[i.id].pressed&&s[i.id]&&(i.keyup&&(h.keyCode=i.keyCode,document.dispatchEvent(h)),s[i.id]=!1))}for(n=0;n<r.joystick.length;n++){var a=r.joystick[n];a.gameState===e&&(a.clipping?t.axes[a.axis]>=a.range[0]&&t.axes[a.axis]<=a.range[1]?(l.keyCode=a.keyCode,document.dispatchEvent(l)):(h.keyCode=a.keyCode,document.dispatchEvent(h)):t.axes[a.axis]>=a.range[0]&&t.axes[a.axis]<=a.range[1]&&!c[n]?(l.keyCode=a.keyCode,document.dispatchEvent(l),c[n]=!0):t.axes[a.axis]<.1&&t.axes[a.axis]>-.1&&c[n]&&(h.keyCode=a.keyCode,document.dispatchEvent(h),c[n]=!1))}}}},CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},l=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new o.init(n,t)}},h=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var c=0;c<t;c+=a)this._doProcessBlock(r,c);c=r.splice(0,t),n.sigBytes-=i}return new o.init(c,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new u.HMAC.init(e,n).finalize(t)}}});var u=n.algo={};return n}(Math);(function(e){function t(e,t,n,r,i,a,o){return e=e+(t&n|~t&r)+i+o,(e<<a|e>>>32-a)+t}function n(e,t,n,r,i,a,o){return e=e+(t&r|n&~r)+i+o,(e<<a|e>>>32-a)+t}function r(e,t,n,r,i,a,o){return e=e+(t^n^r)+i+o,(e<<a|e>>>32-a)+t}function i(e,t,n,r,i,a,o){return e=e+(n^(t|~r))+i+o,(e<<a|e>>>32-a)+t}for(var a=CryptoJS,o=a.lib,s=o.WordArray,c=o.Hasher,o=a.algo,l=[],h=0;64>h;h++)l[h]=4294967296*e.abs(e.sin(h+1))|0;o=o.MD5=c.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var o=0;16>o;o++){var s=a+o,c=e[s];e[s]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var o=this._hash.words,s=e[a+0],c=e[a+1],h=e[a+2],d=e[a+3],u=e[a+4],g=e[a+5],f=e[a+6],p=e[a+7],v=e[a+8],m=e[a+9],y=e[a+10],w=e[a+11],x=e[a+12],S=e[a+13],M=e[a+14],b=e[a+15],C=o[0],E=o[1],j=o[2],_=o[3],C=t(C,E,j,_,s,7,l[0]),_=t(_,C,E,j,c,12,l[1]),j=t(j,_,C,E,h,17,l[2]),E=t(E,j,_,C,d,22,l[3]),C=t(C,E,j,_,u,7,l[4]),_=t(_,C,E,j,g,12,l[5]),j=t(j,_,C,E,f,17,l[6]),E=t(E,j,_,C,p,22,l[7]),C=t(C,E,j,_,v,7,l[8]),_=t(_,C,E,j,m,12,l[9]),j=t(j,_,C,E,y,17,l[10]),E=t(E,j,_,C,w,22,l[11]),C=t(C,E,j,_,x,7,l[12]),_=t(_,C,E,j,S,12,l[13]),j=t(j,_,C,E,M,17,l[14]),E=t(E,j,_,C,b,22,l[15]),C=n(C,E,j,_,c,5,l[16]),_=n(_,C,E,j,f,9,l[17]),j=n(j,_,C,E,w,14,l[18]),E=n(E,j,_,C,s,20,l[19]),C=n(C,E,j,_,g,5,l[20]),_=n(_,C,E,j,y,9,l[21]),j=n(j,_,C,E,b,14,l[22]),E=n(E,j,_,C,u,20,l[23]),C=n(C,E,j,_,m,5,l[24]),_=n(_,C,E,j,M,9,l[25]),j=n(j,_,C,E,d,14,l[26]),E=n(E,j,_,C,v,20,l[27]),C=n(C,E,j,_,S,5,l[28]),_=n(_,C,E,j,h,9,l[29]),j=n(j,_,C,E,p,14,l[30]),E=n(E,j,_,C,x,20,l[31]),C=r(C,E,j,_,g,4,l[32]),_=r(_,C,E,j,v,11,l[33]),j=r(j,_,C,E,w,16,l[34]),E=r(E,j,_,C,M,23,l[35]),C=r(C,E,j,_,c,4,l[36]),_=r(_,C,E,j,u,11,l[37]),j=r(j,_,C,E,p,16,l[38]),E=r(E,j,_,C,y,23,l[39]),C=r(C,E,j,_,S,4,l[40]),_=r(_,C,E,j,s,11,l[41]),j=r(j,_,C,E,d,16,l[42]),E=r(E,j,_,C,f,23,l[43]),C=r(C,E,j,_,m,4,l[44]),_=r(_,C,E,j,x,11,l[45]),j=r(j,_,C,E,b,16,l[46]),E=r(E,j,_,C,h,23,l[47]),C=i(C,E,j,_,s,6,l[48]),_=i(_,C,E,j,p,10,l[49]),j=i(j,_,C,E,M,15,l[50]),E=i(E,j,_,C,g,21,l[51]),C=i(C,E,j,_,x,6,l[52]),_=i(_,C,E,j,d,10,l[53]),j=i(j,_,C,E,y,15,l[54]),E=i(E,j,_,C,c,21,l[55]),C=i(C,E,j,_,v,6,l[56]),_=i(_,C,E,j,b,10,l[57]),j=i(j,_,C,E,f,15,l[58]),E=i(E,j,_,C,S,21,l[59]),C=i(C,E,j,_,u,6,l[60]),_=i(_,C,E,j,w,10,l[61]),j=i(j,_,C,E,h,15,l[62]),E=i(E,j,_,C,m,21,l[63]);o[0]=o[0]+C|0,o[1]=o[1]+E|0,o[2]=o[2]+j|0,o[3]=o[3]+_|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var a=e.floor(r/4294967296);for(n[(i+64>>>9<<4)+15]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[(i+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=c._createHelper(o),a.HmacMD5=c._createHmacHelper(o)})(Math);var ObjectPool=function(){function e(e,t){var r;for(r=0;r<t;r++)if(!e[r].used){var i=e[r];return i.used=!0,n[i.usedIndex]=i,i}return null}function t(e,t,r){for(var i=0;i<t;i++)e[i]=new r,e[i].poolIndex=i,e[i].usedIndex=p,n[p]=null,p++}var n=[],r=200,i=1,a=500,o=30,s=50,c=5,l=[],h=[],d=[],u=[],g=[],f=[];this.shapePool=l,this.playerPool=h,this.bulletPool=d,this.bigbossPool=u,this.turretPool=g,this.powerupPool=f;var p=0;this.getUpdateList=function(){return n},this.usageTest=function(){for(var e=0;e<l.length;e++)if(l[e].used)return!0;for(var e=0;e<g.length;e++)if(g[e].used)return!0;for(var e=0;e<u.length;e++)if(u[e].used)return!0;return!1},this.init=function(){t(h,i,Player),t(l,r,Shape),t(d,a,Bullet),t(u,o,Bigboss),t(g,s,Turret),t(f,c,Powerup),console.log(">> object pools filled")},this.getShape=function(){return e(l,r)},this.getPlayer=function(){return e(h,i)},this.getBullet=function(){return e(d,a)},this.getBigboss=function(){return e(u,o)},this.getTurret=function(){return e(g,s)},this.getPowerup=function(){return e(f,c)},this.dispose=function(e){"Shape"===e.constructor.name?l[e.poolIndex].used=!1:"Player"===e.constructor.name?h[e.poolIndex].used=!1:"Bullet"===e.constructor.name?d[e.poolIndex].used=!1:"Bigboss"===e.constructor.name?u[e.poolIndex].used=!1:"Turret"===e.constructor.name?g[e.poolIndex].used=!1:"Powerup"===e.constructor.name&&(f[e.poolIndex].used=!1),n[e.usedIndex]=null}},ScreenManager=function(){function e(e){var t=n.getSprite("ui","backgroundShape"+c);t.speed=r(1,3),t.rotation=r(50,180),t.x=r(200,600),void 0===e?0===l?t.y=-300:t.y=1100:t.y=e,h.addChild(t),s.push(t),c++,c>4&&(c=1)}var t=Globals.stage,n=Globals.assetManager,r=Globals.randomMe,i=!1,a=Globals.stage.canvas.height,o=0,s=[],c=1,l=0,h=new createjs.Container,d=new createjs.Shape;d.graphics.beginFill("#000022").drawRect(0,0,800,800),d.cache(0,0,800,800),h.addChild(d),t.addChild(h);var u=new LoadScreen;this.load=u,u.showMe();var g=null,f=null,p=null,v=new createjs.Container;this.gameOver=v;var m=n.getSprite("ui","gameOverScreen");v.addChild(m);var y=n.getSprite("ui","spacebarContinue");y.x=240,y.y=420,v.alpha=0,v.addChild(y),this.startMe=function(){u.hideMe(),g=new IntroScreen,this.intro=g,p=new HighScoreScreen,this.highScore=p,f=new GameScreen,this.game=f},this.startBackground=function(){i=!0,o=0,l=0,s=[],e(-300),e(0),e(300),e(600)},this.setDirection=function(e){l=e},this.setScreen=function(e){g.hideMe(),"gameOverScreen"!=e&&f.hideMe(),p.hideMe(),v.alpha=0,createjs.Tween.removeTweens(v),t.removeChild(v),"introScreen"===e?g.showMe():"gameScreen"===e?f.showMe():"highScoreScreen"===e?p.showMe(f.getScore()):"gameOverScreen"===e&&(y.gotoAndStop("spacebarContinue"),Globals.gamepadManager.connected&&y.gotoAndStop("startButtonContinue"),t.addChild(v),createjs.Tween.get(v,{useTicks:!0}).to({alpha:1},40).call(function(){Globals.gameState=GameStates.GAMEOVER}),createjs.Sound.play("gameOver"))},this.stopBackground=function(){i=!1;for(var e=0;e<s.length;e++)h.removeChild(s[e]),s[e]=null;s=[]},this.updateMe=function(){for(var t=0;t<s.length;t++){var n=s[t];0===l?(n.y=n.y+n.speed,n.y-300>a&&(h.removeChild(n),s.splice(t,1))):(n.y=n.y-n.speed,n.y+300<0&&(h.removeChild(n),s.splice(t,1)))}o++,o%150===0&&(e(),o=0)}},WaveFactory=function(){function e(e,t,n){for(var r=0;r<e.length;r++)if(e[r][t]===n)return e[r];return null}function t(){for(var e=0;e<f.length;e++)f[e].time===m&&(f[e].wave.frameCount=f[e].wave.spaced,f[e].wave.dropped=0,p.push(f[e]))}var n=new createjs.Event("gameEvent",!0);n.id="levelChange",n.level=0,n.levelTitle="";var r=new createjs.Event("gameEvent",!0);r.id="godLikeMode";var i=Globals.stage,a=(Globals.assetManager,Globals.objectPool),o=Globals.gameConstants.FRAME_RATE,s=Globals.gameConstants.FRAME_RATE/2,c=0,l=0,h=0,d=0,u="",g=!1,f=null,p=[],v=0,m=0;this.getLevel=function(){return c},this.startMe=function(){c=0,g=!1,this.levelMe()},this.levelMe=function(){c++,v=0,m=0,l=0;var e=c-1;c>20&&(e=Globals.randomMe(0,levelManifest.length-1),g=!0),21===c&&(r.target=null,i.dispatchEvent(r)),f=levelManifest[e],u="undefined"===f[0].levelTitle?"Untitled":f[0].levelTitle,h=0,d=0;for(var t=0;t<f.length;t++)d+=f[t].wave.count;p=[],n.target=null,n.level=c,n.levelTitle=u,i.dispatchEvent(n),createjs.Sound.play("level"),console.log("level title: "+u),console.log("level up: "+c)},this.resetMe=function(){c=0},this.updateMe=function(){for(var n=0;n<p.length;n++){var r=p[n];if(null!==r&&(r.wave.frameCount++,r.wave.frameCount>=r.wave.spaced)){var i=Object.assign({},r.movement);if(r.type.indexOf("boss")!==-1){var c=a.getBigboss(),l=r.settings.turrets;g&&(l.freq=20),c.startMe(r.type,r.settings.x,r.settings.y,r.settings.points,l,i),h++}else{var u=null,f=a.getShape();void 0!==r.settings.shooters&&(u=e(r.settings.shooters,"index",r.wave.dropped));var y="";if(void 0!==r.powerup&&null!==r.powerup){var w=r.powerup.index;r.wave.dropped===w&&(y=r.powerup.type)}g&&null!==u&&(u.freq=20),f.startMe(r.type,r.settings.x,r.settings.y,y,u,i),h++}r.wave.dropped++,r.wave.dropped>=r.wave.count&&(p[n]=null),r.wave.frameCount=0}}v++,v%o===0&&(m++,v=0,t()),m>=50?v%s===0&&createjs.Sound.play("beat2"):m>=30?v%o===0&&createjs.Sound.play("beat2"):v%o===0&&createjs.Sound.play("beat1"),h!==d||a.usageTest()||this.levelMe()}};this.ndgmr=this.ndgmr||{},function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.save();var n=document.createElement("canvas"),r=n.getContext("2d");r.save();var i=[],a=function(e,t){var n,r;return n=d(e),r=d(t),h(n,r)};ndgmr.checkRectCollision=a;var o=function(i,o,l,h){(ndgmr.DEBUG||ndgmr.DEBUG_COLLISION)&&(document.body.appendChild(e),document.body.appendChild(n)),h=h||!1;var d,u,g;return intersection=a(i,o),!!intersection&&(l=l||0,l=Math.min(.99999,l),e.width=intersection.width,e.height=intersection.height,n.width=intersection.width,n.height=intersection.height,d=s(intersection,i,t,1),u=s(intersection,o,r,2),!!(g=c(d,u,intersection.width,intersection.height,l,h))&&(g.x+=intersection.x,g.x2+=intersection.x,g.y+=intersection.y,g.y2+=intersection.y,g))};ndgmr.checkPixelCollision=o;var s=function(e,t,n,r){var a,o,s,c;if(t instanceof createjs.Bitmap)o=t.image;else if(t instanceof createjs.Sprite)frame=t.spriteSheet.getFrame(t.currentFrame),s=frame.image.src+":"+frame.rect.x+":"+frame.rect.y+":"+frame.rect.width+":"+frame.rect.height,i[s]?o=i[s]:i[s]=o=createjs.SpriteSheetUtils.extractFrame(t.spriteSheet,t.currentFrame);else if(t instanceof createjs.MovieClip){var h;void 0!==t.instance.instance?h=t.instance.instance:void 0!==t.instance&&(h=t.instance),frame=h.spriteSheet.getFrame(h.currentFrame),s=frame.image.src+":"+frame.rect.x+":"+frame.rect.y+":"+frame.rect.width+":"+frame.rect.height,i[s]?o=i[s]:i[s]=o=createjs.SpriteSheetUtils.extractFrame(h.spriteSheet,h.currentFrame)}return a=t.globalToLocal(e.x,e.y),n.restore(),n.save(),n.rotate(l(t,"rotation")*(Math.PI/180)),n.scale(l(t,"scaleX","*"),l(t,"scaleY","*")),n.translate(-a.x-e["rect"+r].regX,-a.y-e["rect"+r].regY),void 0!=(c=t.sourceRect)?n.drawImage(o,c.x,c.y,c.width,c.height,0,0,c.width,c.height):n.drawImage(o,0,0,o.width,o.height),n.getImageData(0,0,e.width,e.height).data},c=function(e,t,n,r,i,a){var o,s,c,l,h=3,d={x:1/0,y:1/0,x2:-(1/0),y2:-(1/0)};for(l=0;l<r;++l)for(c=0;c<n;++c){if(o=e.length>h+1?e[h]/255:0,s=t.length>h+1?t[h]/255:0,o>i&&s>i){if(!a)return{x:c,y:l,width:1,height:1};c<d.x&&(d.x=c),c>d.x2&&(d.x2=c),l<d.y&&(d.y=l),l>d.y2&&(d.y2=l)}h+=4}return d.x!==1/0?(d.width=d.x2-d.x+1,d.height=d.y2-d.y+1,d):null},l=function(e,t,n){if(n=n||"+",e.parent&&e.parent[t]){var r=e[t],i=l(e.parent,t,n);return"*"===n?r*i:r+i}return e[t]},h=function(e,t){var n,r,i={},a={};return i.cx=e.x+(i.hw=e.width/2),i.cy=e.y+(i.hh=e.height/2),a.cx=t.x+(a.hw=t.width/2),a.cy=t.y+(a.hh=t.height/2),n=Math.abs(i.cx-a.cx)-(i.hw+a.hw),r=Math.abs(i.cy-a.cy)-(i.hh+a.hh),n<0&&r<0?(n=Math.min(Math.min(e.width,t.width),-n),r=Math.min(Math.min(e.height,t.height),-r),{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:n,height:r,rect1:e,rect2:t}):null};ndgmr.calculateIntersection=h;var d=function(e){var t={x:1/0,y:1/0,width:0,height:0};if(e instanceof createjs.Container){t.x2=-(1/0),t.y2=-(1/0);var n,r,i=e.children,a=i.length;for(r=0;r<a;r++)n=d(i[r]),n.x<t.x&&(t.x=n.x),n.y<t.y&&(t.y=n.y),n.x+n.width>t.x2&&(t.x2=n.x+n.width),n.y+n.height>t.y2&&(t.y2=n.y+n.height);t.x===1/0&&(t.x=0),t.y===1/0&&(t.y=0),t.x2===1/0&&(t.x2=0),t.y2===1/0&&(t.y2=0),t.width=t.x2-t.x,t.height=t.y2-t.y,delete t.x2,delete t.y2}else{var o,s,c,l,h,u={};if(e instanceof createjs.Bitmap)h=e.sourceRect||e.image,u.width=h.width,u.height=h.height;else if(e instanceof createjs.Sprite)if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){var g=e.spriteSheet.getFrame(e.currentFrame);u.width=g.rect.width,u.height=g.rect.height,u.regX=g.regX,u.regY=g.regY}else t.x=e.x||0,t.y=e.y||0;else t.x=e.x||0,t.y=e.y||0;u.regX=u.regX||0,u.width=u.width||0,u.regY=u.regY||0,u.height=u.height||0,t.regX=u.regX,t.regY=u.regY,o=e.localToGlobal(0-u.regX,0-u.regY),s=e.localToGlobal(u.width-u.regX,u.height-u.regY),c=e.localToGlobal(u.width-u.regX,0-u.regY),l=e.localToGlobal(0-u.regX,u.height-u.regY),t.x=Math.min(Math.min(Math.min(o.x,s.x),c.x),l.x),t.y=Math.min(Math.min(Math.min(o.y,s.y),c.y),l.y),t.width=Math.max(Math.max(Math.max(o.x,s.x),c.x),l.x)-t.x,t.height=Math.max(Math.max(Math.max(o.y,s.y),c.y),l.y)-t.y}return t};ndgmr.getBounds=d}();